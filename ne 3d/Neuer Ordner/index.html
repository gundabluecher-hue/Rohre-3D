<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Curve Fever 3D</title>
    <link rel="stylesheet" href="style.css">
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>
</head>

<body>
    <div id="game-container">
        <canvas id="game-canvas" aria-label="3D Spielansicht"></canvas>
        <div id="crosshair-container" aria-hidden="true">
            <div id="crosshair-p1" class="crosshair">
                <div class="circle"></div>
                <div class="dot"></div>
            </div>
            <div id="crosshair-p2" class="crosshair">
                <div class="circle"></div>
                <div class="dot"></div>
            </div>
        </div>
    </div>

    <div id="ui-layer">
        <div id="main-menu" role="dialog" aria-modal="true" aria-labelledby="main-menu-title">
            <div class="menu-content" role="document">
                <h1 id="main-menu-title">Mini Curve Fever 3D</h1>
                <p class="subtitle">Multiplayer Luftkampf Arena</p>
                <div id="build-info" class="build-info"></div>
                <p id="menu-context" class="menu-context" role="status" aria-live="polite" aria-atomic="true">
                    Hauptmenue · Profil: kein Profil · alles gespeichert
                </p>
                <div id="keybind-warning" class="keybind-warning hidden" role="status" aria-live="polite"
                    aria-atomic="true"></div>

                <!-- ======= HAUPTNAVIGATION ======= -->
                <div id="menu-nav" class="menu-nav-grid" role="navigation" aria-label="Hauptmenue">
                    <button type="button" class="nav-btn" data-submenu="submenu-game" aria-controls="submenu-game"
                        aria-expanded="false">🎮 Spiel starten</button>
                    <button type="button" class="nav-btn" data-submenu="submenu-settings"
                        aria-controls="submenu-settings" aria-expanded="false">⚙️ Einstellungen</button>
                    <button type="button" class="nav-btn" data-submenu="submenu-controls"
                        aria-controls="submenu-controls" aria-expanded="false">🎯 Steuerung</button>
                    <button type="button" class="nav-btn" data-submenu="submenu-profiles"
                        aria-controls="submenu-profiles" aria-expanded="false">👤 Profile</button>
                    <button type="button" class="nav-btn" data-submenu="submenu-portals" aria-controls="submenu-portals"
                        aria-expanded="false">🌀 Portale / Map</button>
                    <button type="button" class="nav-btn" data-submenu="submenu-debug" aria-controls="submenu-debug"
                        aria-expanded="false">ℹ️ Debug / Info</button>
                    <div class="nav-help-card" role="note">
                        <div class="nav-help-title">Schnellstart</div>
                        <div class="nav-help-content">
                            <span><kbd>ESC</kbd> Zurueck ins Menue</span>
                            <span><kbd>F</kbd> FPS Overlay</span>
                            <span><kbd>P</kbd> Grafik umschalten</span>
                        </div>
                    </div>
                </div>

                <!-- ======= SUBMENU: SPIEL STARTEN ======= -->
                <div id="submenu-game" class="submenu-panel hidden" role="region" aria-labelledby="submenu-game-title"
                    aria-hidden="true">
                    <div class="submenu-header">
                        <button type="button" class="back-btn" data-back aria-label="Zur Hauptnavigation">←
                            Zurück</button>
                        <h2 id="submenu-game-title" class="submenu-title">🎮 Spiel starten</h2>
                    </div>

                    <div class="submenu-body">
                        <div class="menu-section">
                            <h2 class="section-title">Spielmodus</h2>
                            <div class="btn-group">
                                <button id="btn-1p" class="mode-btn active" data-mode="1p">1 Spieler</button>
                                <button id="btn-2p" class="mode-btn" data-mode="2p">2 Spieler</button>
                            </div>
                        </div>

                        <div class="menu-section">
                            <label for="map-select">Map</label>
                            <select id="map-select">
                                <option value="standard">Standard Arena</option>
                                <option value="empty">Leer</option>
                                <option value="maze">Labyrinth</option>
                                <option value="complex">Komplex</option>
                                <option value="pyramid">Pyramide</option>
                            </select>
                        </div>

                        <div class="menu-section">
                            <label for="bot-count">Bots: <span id="bot-count-label">1</span></label>
                            <input type="range" id="bot-count" min="0" max="8" value="1">
                        </div>

                        <div class="menu-section">
                            <label for="bot-difficulty">Bot-Schwierigkeit</label>
                            <select id="bot-difficulty">
                                <option value="EASY">Easy</option>
                                <option value="NORMAL" selected>Normal</option>
                                <option value="HARD">Hard</option>
                            </select>
                        </div>

                        <div class="menu-section">
                            <label for="win-count">Siege zum Gewinn: <span id="win-count-label">5</span></label>
                            <input type="range" id="win-count" min="1" max="15" value="5">
                        </div>

                        <button type="button" id="btn-start" class="start-btn">Spiel starten</button>
                    </div>
                </div>

                <!-- ======= SUBMENU: EINSTELLUNGEN ======= -->
                <div id="submenu-settings" class="submenu-panel hidden" role="region"
                    aria-labelledby="submenu-settings-title" aria-hidden="true">
                    <div class="submenu-header">
                        <button type="button" class="back-btn" data-back aria-label="Zur Hauptnavigation">←
                            Zurück</button>
                        <h2 id="submenu-settings-title" class="submenu-title">⚙️ Einstellungen</h2>
                    </div>

                    <div class="submenu-body">
                        <div class="menu-section">
                            <label for="speed-slider">Geschwindigkeit: <span id="speed-label">18.0</span></label>
                            <input type="range" id="speed-slider" min="8" max="40" step="0.5" value="18">
                        </div>

                        <div class="menu-section">
                            <label for="turn-slider">Lenk-Empfindlichkeit: <span id="turn-label">2.2</span></label>
                            <input type="range" id="turn-slider" min="0.8" max="5.0" step="0.1" value="2.2">
                        </div>

                        <div class="menu-section">
                            <label for="plane-size-slider">Flugzeug-Groesse: <span
                                    id="plane-size-label">1.0</span></label>
                            <input type="range" id="plane-size-slider" min="0.6" max="2.0" step="0.1" value="1.0">
                        </div>

                        <div class="menu-section">
                            <label for="trail-width-slider">Strahldicke: <span
                                    id="trail-width-label">0.60</span></label>
                            <input type="range" id="trail-width-slider" min="0.2" max="2.5" step="0.05" value="0.6">
                        </div>

                        <div class="menu-section">
                            <label for="gap-size-slider">Luecken-Groesse: <span id="gap-size-label">0.30</span></label>
                            <input type="range" id="gap-size-slider" min="0.05" max="1.5" step="0.05" value="0.3">
                        </div>

                        <div class="menu-section">
                            <label for="gap-frequency-slider">Luecken-Haeufigkeit: <span
                                    id="gap-frequency-label">0.020</span></label>
                            <input type="range" id="gap-frequency-slider" min="0" max="0.25" step="0.005" value="0.02">
                        </div>

                        <div class="menu-section">
                            <label for="item-amount-slider">Item-Menge: <span id="item-amount-label">8</span></label>
                            <input type="range" id="item-amount-slider" min="1" max="20" step="1" value="8">
                        </div>

                        <div class="menu-section">
                            <label for="fire-rate-slider">Schussgeschwindigkeit: <span
                                    id="fire-rate-label">0.45</span>s</label>
                            <input type="range" id="fire-rate-slider" min="0.1" max="2.0" step="0.05" value="0.45">
                        </div>

                        <div class="menu-section">
                            <label for="lockon-slider">Lock-On Radius: <span id="lockon-label">15</span>°</label>
                            <input type="range" id="lockon-slider" min="5" max="45" step="1" value="15">
                        </div>

                        <div class="menu-section">
                            <button type="button" id="btn-save-keys" class="secondary-btn secondary-btn-spaced">💾
                                Einstellungen explizit speichern</button>
                        </div>
                    </div>
                </div>

                <!-- ======= SUBMENU: STEUERUNG ======= -->
                <div id="submenu-controls" class="submenu-panel hidden" role="region"
                    aria-labelledby="submenu-controls-title" aria-hidden="true">
                    <div class="submenu-header">
                        <button type="button" class="back-btn" data-back aria-label="Zur Hauptnavigation">←
                            Zurück</button>
                        <h2 id="submenu-controls-title" class="submenu-title">🎯 Steuerung</h2>
                    </div>

                    <div class="submenu-body">
                        <div class="submenu-columns">
                            <div>
                                <div class="menu-section">
                                    <h2 class="section-title">Tasten Spieler 1</h2>
                                    <div id="keybind-p1" class="keybind-grid"></div>
                                </div>
                            </div>
                            <div>
                                <div class="menu-section">
                                    <h2 class="section-title">Tasten Spieler 2</h2>
                                    <div id="keybind-p2" class="keybind-grid"></div>
                                </div>
                            </div>
                        </div>

                        <div class="menu-section">
                            <label for="auto-roll-toggle">Auto-Roll</label>
                            <label class="toggle-row">
                                <input type="checkbox" id="auto-roll-toggle" checked>
                                <span>Stabilisierung aktiv</span>
                            </label>
                        </div>

                        <div class="menu-section">
                            <h2 class="section-title">Invert Pitch (hoch/runter)</h2>
                            <div class="toggle-grid">
                                <label class="toggle-row">
                                    <input type="checkbox" id="invert-p1">
                                    <span>Spieler 1</span>
                                </label>
                                <label class="toggle-row">
                                    <input type="checkbox" id="invert-p2">
                                    <span>Spieler 2</span>
                                </label>
                            </div>
                        </div>

                        <div class="menu-section">
                            <h2 class="section-title">Cockpit-Kamera (Horizont dreht mit)</h2>
                            <div class="toggle-grid">
                                <label class="toggle-row">
                                    <input type="checkbox" id="cockpit-cam-p1">
                                    <span>Spieler 1</span>
                                </label>
                                <label class="toggle-row">
                                    <input type="checkbox" id="cockpit-cam-p2">
                                    <span>Spieler 2</span>
                                </label>
                            </div>
                        </div>

                        <div class="menu-section">
                            <button type="button" id="btn-reset-keys" class="secondary-btn">Standard-Tasten
                                wiederherstellen</button>
                        </div>
                    </div>
                </div>

                <!-- ======= SUBMENU: PROFILE ======= -->
                <div id="submenu-profiles" class="submenu-panel hidden" role="region"
                    aria-labelledby="submenu-profiles-title" aria-hidden="true">
                    <div class="submenu-header">
                        <button type="button" class="back-btn" data-back aria-label="Zur Hauptnavigation">←
                            Zurück</button>
                        <h2 id="submenu-profiles-title" class="submenu-title">👤 Profile</h2>
                    </div>

                    <div class="submenu-body">
                        <div class="menu-section">
                            <h2 class="section-title">Preset-Profile</h2>
                            <label for="profile-name">Profilname</label>
                            <input type="text" id="profile-name" maxlength="32" placeholder="z. B. Turnier">
                            <button type="button" id="btn-profile-save" class="secondary-btn secondary-btn-spaced">
                                Profil unter Namen speichern</button>
                        </div>

                        <div class="menu-section">
                            <label for="profile-select">Gespeicherte Profile</label>
                            <select id="profile-select">
                                <option value="">Kein Profil gewaehlt</option>
                            </select>
                            <button type="button" id="btn-profile-load" class="secondary-btn secondary-btn-spaced">
                                Profil laden</button>
                            <button type="button" id="btn-profile-delete" class="secondary-btn secondary-btn-spaced">
                                Profil loeschen</button>
                        </div>
                    </div>
                </div>

                <!-- ======= SUBMENU: PORTALE / MAP ======= -->
                <div id="submenu-portals" class="submenu-panel hidden" role="region"
                    aria-labelledby="submenu-portals-title" aria-hidden="true">
                    <div class="submenu-header">
                        <button type="button" class="back-btn" data-back aria-label="Zur Hauptnavigation">←
                            Zurück</button>
                        <h2 id="submenu-portals-title" class="submenu-title">🌀 Portale / Map</h2>
                    </div>

                    <div class="submenu-body">
                        <div class="menu-section">
                            <label class="toggle-row">
                                <input type="checkbox" id="portals-toggle" checked>
                                <span>Portale aktiviert</span>
                            </label>
                        </div>

                        <div class="menu-section">
                            <label for="portal-count-slider">Anzahl Portale: <span
                                    id="portal-count-label">0</span></label>
                            <input type="range" id="portal-count-slider" min="0" max="20" step="2" value="0">
                        </div>

                        <div class="menu-section">
                            <label for="planar-level-count-slider">Anzahl Ebenen: <span
                                    id="planar-level-count-label">5</span></label>
                            <input type="range" id="planar-level-count-slider" min="2" max="10" step="1" value="5">
                        </div>

                        <div class="menu-section">
                            <label for="planar-mode-toggle">Ebene erzwingen</label>
                            <label class="toggle-row">
                                <input type="checkbox" id="planar-mode-toggle">
                                <span>Planar Modus (Kein Pitch)</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- ======= SUBMENU: DEBUG / INFO ======= -->
                <div id="submenu-debug" class="submenu-panel hidden" role="region" aria-labelledby="submenu-debug-title"
                    aria-hidden="true">
                    <div class="submenu-header">
                        <button type="button" class="back-btn" data-back aria-label="Zur Hauptnavigation">←
                            Zurück</button>
                        <h2 id="submenu-debug-title" class="submenu-title">ℹ️ Debug / Info</h2>
                    </div>

                    <div class="submenu-body">
                        <div class="menu-section">
                            <h2 class="section-title">Build-Information</h2>
                            <div id="build-info-detail" class="build-info-detail"></div>
                            <button type="button" id="btn-copy-build" class="secondary-btn secondary-btn-spaced">
                                Build-Info kopieren
                            </button>
                        </div>
                        <div class="menu-section">
                            <h2 class="section-title">Bot Learning / Developer-Modus</h2>
                            <label class="toggle-row">
                                <input type="checkbox" id="training-enabled-toggle">
                                <span>Lernschicht aktivieren</span>
                            </label>
                            <label class="toggle-row">
                                <input type="checkbox" id="training-bot-only-toggle">
                                <span>Nur Bots gegeneinander (0 menschliche Spieler)</span>
                            </label>
                            <label class="toggle-row">
                                <input type="checkbox" id="training-mortal-bots-toggle">
                                <span>Bots sterblich (kein Bounce-Unsterblich-Modus)</span>
                            </label>
                            <label class="toggle-row">
                                <input type="checkbox" id="training-auto-restart-toggle" checked>
                                <span>Runden automatisch neu starten</span>
                            </label>
                            <label class="toggle-row">
                                <input type="checkbox" id="training-spectator-split-toggle">
                                <span>Bot-Spectator Split-Screen (2 Kameraansichten)</span>
                            </label>
                            <label class="toggle-row">
                                <input type="checkbox" id="training-dual-worlds-toggle">
                                <span>2 Welten: je 2 Bots (Welt 2 im Ebenen-Modus)</span>
                            </label>

                            <label for="training-time-scale-slider">Training-Speed: <span id="training-time-scale-label">1000.0</span>x</label>
                            <input type="range" id="training-time-scale-slider" min="0.5" max="1000.0" step="0.5" value="1000.0">

                            <label for="training-autosave-rounds-slider">Autosave alle <span id="training-autosave-rounds-label">5</span> Runden</label>
                            <input type="range" id="training-autosave-rounds-slider" min="1" max="50" step="1" value="5">

                            <button type="button" id="btn-training-start" class="secondary-btn secondary-btn-spaced">
                                Developer-Training starten
                            </button>
                            <button type="button" id="btn-training-save" class="secondary-btn secondary-btn-spaced">
                                Lerndaten jetzt speichern
                            </button>
                            <button type="button" id="btn-training-reset" class="secondary-btn secondary-btn-spaced">
                                Lerndaten zuruecksetzen
                            </button>
                            <div id="training-status" class="build-info-detail"></div>
                        </div>
                        <div class="menu-section">
                            <p class="debug-hint">Drücke <kbd>F</kbd> im Spiel für FPS-Overlay</p>
                            <p class="debug-hint">Drücke <kbd>P</kbd> im Spiel für Grafik-Toggle</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div id="hud" class="hidden">
            <!-- P1 Fighter HUD -->
            <div id="p1-fighter-hud" class="fighter-hud hidden">
                <div class="hud-center-crosshair">+</div>
                <div class="hud-bank-line"></div>
                <div class="hud-bank-angle">0°</div>
                <div class="hud-horizon">
                    <div class="horizon-line"></div>
                </div>
                <div class="hud-pitch-ladder">
                    <!-- Lines generated by JS -->
                </div>
                <div class="hud-tape left">
                    <div class="tape-label">SPD</div>
                    <div class="tape-value" id="p1-hud-speed">0</div>
                    <div class="tape-scale" id="p1-hud-speed-scale"></div>
                    <div class="tape-marker">►</div>
                </div>
                <div class="hud-tape right">
                    <div class="tape-label">ALT</div>
                    <div class="tape-value" id="p1-hud-alt">0</div>
                    <div class="tape-scale" id="p1-hud-alt-scale"></div>
                    <div class="tape-marker">◄</div>
                </div>
                <div class="hud-tape top">
                    <div class="tape-value" id="p1-hud-heading">N</div>
                    <div class="tape-scale horizontal" id="p1-hud-heading-scale"></div>
                    <div class="tape-marker">▼</div>
                </div>
                <div id="p1-lock-reticle" class="hud-lock-reticle hidden">
                    <div class="lock-box"></div>
                    <div class="lock-dist"></div>
                </div>
            </div>

            <!-- P2 Fighter HUD -->
            <div id="p2-fighter-hud" class="fighter-hud p2 hidden">
                <div class="hud-center-crosshair">+</div>
                <div class="hud-bank-line"></div>
                <div class="hud-bank-angle">0°</div>
                <div class="hud-horizon">
                    <div class="horizon-line"></div>
                </div>
                <div class="hud-pitch-ladder"></div>
                <div class="hud-tape left">
                    <div class="tape-label">SPD</div>
                    <div class="tape-value" id="p2-hud-speed">0</div>
                    <div class="tape-scale" id="p2-hud-speed-scale"></div>
                    <div class="tape-marker">►</div>
                </div>
                <div class="hud-tape right">
                    <div class="tape-label">ALT</div>
                    <div class="tape-value" id="p2-hud-alt">0</div>
                    <div class="tape-scale" id="p2-hud-alt-scale"></div>
                    <div class="tape-marker">◄</div>
                </div>
                <div class="hud-tape top">
                    <div class="tape-value" id="p2-hud-heading">N</div>
                    <div class="tape-scale horizontal" id="p2-hud-heading-scale"></div>
                    <div class="tape-marker">▼</div>
                </div>
                <div id="p2-lock-reticle" class="hud-lock-reticle hidden">
                    <div class="lock-box"></div>
                    <div class="lock-dist"></div>
                </div>
            </div>

            <div id="p1-hud" class="player-hud left">
                <div class="player-name">Spieler 1</div>
                <div class="player-score">0</div>
                <div id="p1-items" class="item-bar"></div>
            </div>
            <div id="p2-hud" class="player-hud right hidden">
                <div class="player-name">Spieler 2</div>
                <div class="player-score">0</div>
                <div id="p2-items" class="item-bar"></div>
            </div>
            <div id="message-overlay" class="hidden" role="alert" aria-live="assertive" aria-atomic="true">
                <div id="message-text"></div>
                <div id="message-sub"></div>
            </div>
            <div id="training-overlay" class="training-overlay hidden" role="status" aria-live="polite" aria-atomic="true">
                <div class="training-overlay-header">
                    <span class="training-overlay-title">TRAINING PROGRESS</span>
                    <span id="training-overlay-progress-label" class="training-overlay-progress-label">0%</span>
                </div>
                <div id="training-overlay-lines" class="training-overlay-lines"></div>
                <div class="training-overlay-bar">
                    <div id="training-overlay-progress-fill" class="training-overlay-progress-fill"></div>
                </div>
            </div>
            <div id="status-toast" class="hidden" role="status" aria-live="polite" aria-atomic="true"></div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>

</html>
